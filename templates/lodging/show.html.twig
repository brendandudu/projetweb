{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} | {{ lodging.name }}{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css"/>
    <link href="{{ asset('css/showLodging.css') }}" rel="stylesheet"/>
{% endblock %}
{% block body %}

    <div class="card card-custom-wide">
        <div class="card-custom-wide-img" style="background-image: url(/assets/img/lodging/{{ lodging.picture }});"></div>
        <div class="card-custom-avatar">
            {% if lodging.user.picture %}
                <img class="img-fluid" src="/assets/img/user/{{ lodging.user.picture }}" alt="Avatar" />
            {% else %}
                <img class="img-fluid" src="/user/img/user.png" alt="Avatar" />
            {% endif %}
        </div>
        <div class="card-body">
            <div class="lodging-desc">
                <h2 class="card-title">{{ lodging.name }}</h2>
                <p class="card-text"><i class="fas fa-map-marked-alt"></i> {{ lodging.fullAddress }}</p>
                <p class="card-text">{{ lodging.description }}</p>
                <hr>
            </div>
            <div class="lodging-info">
                <h4 class="card-info">Informations sur l'hébergements :</h4> <br>
                <p class="card-text"><i class="fas fa-arrows-alt"></i> {{ lodging.space }} m²</p>
                <p class="card-text"><i class="fas fa-user"></i> {{ lodging.capacity }} personne(s)</p>
                <p class="card-text"><i class="fas fa-wifi"></i> <i class="{{ lodging.internetAvailable ? "fas fa-check text-success" : "fas fa-times text-danger" }}"></i></p>
                <hr>
            </div>
            <div class="user-info">
                <h4 class="card-info">Informations sur le propriétaire :</h4> <br>
                <p class="card-text"><u>Nom:</u> {{ lodging.user.lastName }}</p>
                <p class="card-text"><u>Prénom:</u> {{ lodging.user.firstName }}</p>
                <p class="card-text"><u>Adresse email:</u> <a href="mailto:{{ lodging.user.email }}">{{ lodging.user.email }}</p></a>
                <p class="card-text"><u>Téléphone:</u> {{ lodging.user.phone ? "indisponible" : lodging.user.phone }}</p>
                <hr>
            </div>
            <div class="booking-info">
                <h4 class="card-info">Ma réservation :</h4> <br>
                <div class="container mt-4">
                    {% if app.user %}
                        {% if not is_granted('ROLE_HOST') %}
                            {% include 'includes/_bookingForm.html.twig' %}
                        {% endif %}
                    {% else %}
                        <div class="row justify-content-center">
                            <div class="text-center alert alert-danger col-md-4">
                                Merci de vous <a href="{{ path('app_login') }}">connectez</a> pour réserver
                            </div>
                        </div>
                    {% endif %}
                </div>
                {% if not formBooking.vars.valid %}
                    <div class="alert alert-danger">
                        <ul>
                            {% for child in formBooking.children %}
                                {% for error in child.vars.errors %}
                                    <li>{{ error.message }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>
            <hr>
            <div class="comments">
                <h4 class="card-info">Commentaires sur ce logement :</h4> <br>
                <div class="container">
                    {% if canUserRate %}
                    {{ form_start(formComment, { attr: { class: 'comment-form' }})}}
                        <div class="form-group">
                            <label for="comment">Vous avez séjourné ici dans le passé, vous pouvez donc laisser un commentaire :</label>
                            {{ form_widget(formComment.comment, { attr: { class: "form-control", rows: "3" }})}}
                            <fieldset class="rating"> 
                            {% for key, item in formComment.rate.children %}
                                {{ form_widget(item) }}
                                <label class="full" for="comment_rate_{{ key }}" title="{{ 5 - key }} étoiles"></label>
                            {% endfor %}
                                <input type="radio" class="reset-option" name="rating" value="reset" /> 
                            </fieldset>
                        </div>
                        <button type="submit" class="btn btn-default">Commenter</button>
                    {{ form_end(formComment) }}
                    {% endif %}
                    <div class="row">
                        <div class="col-12">
                            {% for comment in comments %}
                            <div class="card card-white post">
                                <div class="post-heading">
                                    <div class="float-left image">
                                        <img src="" class="img-circle avatar" alt="user profile image">
                                    </div>
                                    <div class="float-left meta">
                                        <div class="title h5">
                                            <a href="#"><b>{{ comment.user.firstName }}</b></a>
                                        </div>
                                        <h6 class="text-muted time">Le {{ comment.date|date("d/m/Y")}}</h6>
                                    </div>
                                    <div class="float-right rate">
                                        <b>{{ comment.rate }}/5</b>
                                    </div>
                                </div> 
                                <div class="post-description"> 
                                    <p>{{ comment.comment }}</p>

                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block javascripts %}

<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js"></script>

<script>
    let dateRanges = {{ dates|json_encode|raw }};

    const picker = new Litepicker({
        element: document.getElementById('booking_beginsAt'),
        elementEnd: document.getElementById('booking_endsAt'),
        singleMode: false,
        numberOfMonths: 2,
        numberOfColumns:2,
        lang: "fr-FR",
        minDate: new Date(),
        resetButton: true,
        disallowLockDaysInRange: true,
        lockDays: dateRanges,
        minDays: 2,
    });

    $("input[type='radio']").click(function(){
        var sim = $("input[type='radio']:checked").val();
        //alert(sim);
        if (sim<3) { 
            $('.myratings').css('color','red'); 
            $(".myratings").text(sim); 
        }
        else{ 
            $('.myratings').css('color','green'); $(".myratings").text(sim); 
        }
    }); 
</script>

{% endblock %}